name: Pull Request Build Check

on:
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Install minify CLI
        run: |
          sudo apt-get update -y
          sudo apt-get install -y minify
      - name: Copy repository into dist directory
        run: |
          mkdir -p dist
          rsync -a --exclude='.git' ./ dist/
      - name: Run minification tests
        run: |
          # Minify HTML, CSS, and JS files in dist
          find dist -type f -name '*.html' -print0 | xargs -0 -n1 -P4 sh -c 'minify "$0" > "$0.tmp" && mv "$0.tmp" "$0"'
          find dist -type f -name '*.css' -print0 | xargs -0 -n1 -P4 sh -c 'minify "$0" > "$0.tmp" && mv "$0.tmp" "$0"'
          find dist -type f -name '*.js' -print0 | xargs -0 -n1 -P4 sh -c 'minify "$0" > "$0.tmp" && mv "$0.tmp" "$0"'
      - name: Archive built site
        uses: actions/upload-artifact@v4
        with:
          name: pr-build-dist
          path: dist